{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - {{ session.username }}{% endblock %}

{% block breadcrumb_items %}
    <li class="breadcrumb-item active">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="card">
            <div class="card-header">
                <h5>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <h3>{{ session.username }}</h3>
                    <p class="text-muted">–£—á–∞—Å—Ç–Ω–∏–∫ —Å {{ user_data.created_at[:10] }}</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item text-center">
                        <h4 class="text-primary">{{ total_tests }}</h4>
                        <small>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤</small>
                    </div>
                    <div class="stat-item text-center">
                        <h4 class="text-success">{{ average_percentage|round(1) }}%</h4>
                        <small>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</small>
                    </div>
                    <div class="stat-item text-center">
                        <h4 class="text-info">{{ total_time|round(1) }}</h4>
                        <small>–ß–∞—Å–æ–≤ –æ–±—É—á–µ–Ω–∏—è</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>üìö –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h5>
            </div>
            <div class="card-body">
                {% for progress in subject_progress %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>{{ progress.subject_name }}</span>
                        <span class="fw-bold">{{ progress.correct_answered }}/{{ progress.total_answered }}</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ (progress.correct_answered / progress.total_answered * 100) if progress.total_answered > 0 else 0 }}%">
                        </div>
                    </div>
                    <small class="text-muted">
                        {{ ((progress.correct_answered / progress.total_answered * 100) if progress.total_answered > 0 else 0)|round(1) }}%
                    </small>
                </div>
                {% else %}
                <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <!-- –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h5>üìã –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤</h5>
            </div>
            <div class="card-body">
                {% if test_results %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í–∞—Ä–∏–∞–Ω—Ç</th>
                                <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–î–µ—Ç–∞–ª–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in test_results %}
                            <tr>
                                <td>{{ result.completed_at[:16] }}</td>
                                <td>{{ result.variant_name }}</td>
                                <td>
                                    <span class="badge bg-{% if result.percentage >= 70 %}success{% elif result.percentage >= 50 %}warning{% else %}danger{% endif %}">
                                        {{ result.score }}/{{ result.total_questions }} ({{ result.percentage|round(1) }}%)
                                    </span>
                                </td>
                                <td>{{ (result.time_spent / 60)|round(1) }} –º–∏–Ω.</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary">üëÅÔ∏è</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <h5>–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</h5>
                    <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –ï–ù–¢ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
                    <a href="{{ url_for('index') }}" class="btn btn-primary">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>üìà –î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h5>
            </div>
            <div class="card-body">
                <div id="progressChart" style="height: 250px;">
                    <p class="text-muted text-center py-5">–ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}
.stat-item {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
}
.progress {
    background-color: #e9ecef;
}
</style>
{% endblock %}