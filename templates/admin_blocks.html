{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏{% endblock %}

{% block breadcrumb_items %}
    <li class="breadcrumb-item active">–ë–ª–æ–∫–∏</li>
{% endblock %}

{% block header_actions %}
    <button class="btn btn-success" onclick="showAddForm()">
        + –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
    </button>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
        <div id="addBlockForm" class="mb-4 p-3 border rounded" style="display: none;">
            <h5>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –±–ª–æ–∫</h5>
            <form method="POST" action="{{ url_for('add_block') }}">
                <div class="row align-items-end">
                    <div class="col-md-4">
                        <label for="blockName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞:</label>
                        <input type="text" class="form-control" id="blockName" name="name"
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§–∏–∑–∏–∫–∞-–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="hasCalculator" name="has_calculator">
                            <label class="form-check-label" for="hasCalculator">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="hasPeriodicTable" name="has_periodic_table">
                            <label class="form-check-label" for="hasPeriodicTable">–¢–∞–±–ª–∏—Ü–∞ –ú–µ–Ω–¥–µ–ª–µ–µ–≤–∞</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddForm()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </form>
        </div>

        {% if blocks %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞</th>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for block in blocks %}
                        <tr>
                            <td>{{ block.id }}</td>
                            <td>
                                <span id="blockName_{{ block.id }}">{{ block.name }}</span>
                                <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞) -->
                                <form id="editForm_{{ block.id }}" method="POST" action="{{ url_for('edit_block', block_id=block.id) }}" style="display: none;">
                                    <input type="text" class="form-control form-control-sm" name="name" value="{{ block.name }}" required>
                                </form>
                            </td>
                            <td>
                                {% if block.has_calculator %}üßÆ{% endif %}
                                {% if block.has_periodic_table %}‚öóÔ∏è{% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('admin_variants', block_id=block.id) }}" class="btn btn-sm btn-primary">
                                    –í–∞—Ä–∏–∞–Ω—Ç—ã
                                </a>
                                <button class="btn btn-sm btn-warning" onclick="toggleEdit({{ block.id }})">
                                    ‚úèÔ∏è
                                </button>
                                <form action="{{ url_for('delete_block', block_id=block.id) }}" method="POST" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-danger"
                                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫ ¬´{{ block.name }}¬ª?')">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-center py-5">
                <h4>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –±–ª–æ–∫–∞</h4>
                <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
.form-control.form-control-sm {
    display: inline-block;
    width: auto;
}
</style>

<script>
function showAddForm() {
    document.getElementById('addBlockForm').style.display = 'block';
}

function hideAddForm() {
    document.getElementById('addBlockForm').style.display = 'none';
}

function toggleEdit(blockId) {
    const nameSpan = document.getElementById('blockName_' + blockId);
    const editForm = document.getElementById('editForm_' + blockId);

    if (nameSpan.style.display !== 'none') {
        nameSpan.style.display = 'none';
        editForm.style.display = 'inline-block';
        editForm.querySelector('input').focus();
    } else {
        nameSpan.style.display = 'inline';
        editForm.style.display = 'none';
        editForm.submit(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏
    }
}

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('input[name="name"]').forEach(input => {
        input.addEventListener('blur', function() {
            this.closest('form').submit();
        });
    });
});
</script>
{% endblock %}